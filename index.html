<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿéš›ç¨‹å¼å¤§å†’éšª</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- å¼•å…¥ Babel ç”¨æ–¼è§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* è‡ªå®šç¾©æ²è»¸æ¨£å¼ */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin-slow 10s linear infinite;
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        body {
            overscroll-behavior: none;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 h-screen overflow-hidden font-sans">
    <div id="root" class="h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icons ---
        const Icons = {
            Play: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>,
            RotateCcw: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></svg>,
            Volume2: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>,
            Move: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="5 9 2 12 5 15"></polyline><polyline points="9 5 12 2 15 5"></polyline><polyline points="19 9 22 12 19 15"></polyline><polyline points="9 19 12 22 15 19"></polyline><line x1="2" y1="12" x2="22" y2="12"></line><line x1="12" y1="2" x2="12" y2="22"></line></svg>,
            MousePointer: ({size=24, className="", fill="none"}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 3 7.07 16.97 2.51-7.39 7.39-2.51L3 3z"></path><path d="m13 13 6 6"></path></svg>,
            MessageCircle: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path></svg>,
            Layers: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>,
            ImageIcon: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect><circle cx="9" cy="9" r="2"></circle><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path></svg>,
            MapPin: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path><circle cx="12" cy="10" r="3"></circle></svg>,
            Star: ({size=24, className="", fill="none"}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>,
            Trophy: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17"></path><path d="M14 14.66V17"></path><path d="M12 2v20"></path><path d="M8.21 13.89L7 23"></path><path d="M15.79 13.89L17 23"></path></svg>,
            AlertCircle: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>,
            ArrowRight: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg>,
            Lightbulb: ({size=24, className="", fill="none"}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1 1.5-2.4 1.5-3.8 0-3.2-2.8-5.7-6-5.7s-6 2.5-6 5.7c0 1.4.5 2.8 1.5 3.8.8.8 1.3 1.5 1.5 2.5"></path><path d="M9 18h6"></path><path d="M10 22h4"></path></svg>,
            Calculator: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="16" y1="14" x2="16" y2="18"></line><path d="M16 10h.01"></path><path d="M12 10h.01"></path><path d="M8 10h.01"></path><path d="M12 14h.01"></path><path d="M8 14h.01"></path><path d="M12 18h.01"></path><path d="M8 18h.01"></path></svg>,
            Keyboard: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="16" x="2" y="4" rx="2" ry="2"></rect><path d="M6 8h.001"></path><path d="M10 8h.001"></path><path d="M14 8h.001"></path><path d="M18 8h.001"></path><path d="M6 12h.001"></path><path d="M10 12h.001"></path><path d="M14 12h.001"></path><path d="M18 12h.001"></path><path d="M7 16h10"></path></svg>,
            BookOpen: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>,
            CornerDownRight: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 10 20 15 15 20"></polyline><path d="M4 4v7a4 4 0 0 0 4 4h12"></path></svg>,
            User: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>,
            RotateCw: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path></svg>,
            Flag: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path><line x1="4" x2="4" y1="22" y2="15"></line></svg>
        };

        const LEVELS = [
            {
                id: 1,
                title: "ç¬¬ä¸€é—œï¼šå¼•æ“å•Ÿå‹•",
                description: "å–µéšŠé•·çš„å¤ªç©ºèˆ¹å¤±å»å‹•åŠ›äº†ï¼æˆ‘å€‘éœ€è¦é‡æ–°å•Ÿå‹•ç³»çµ±ã€‚è«‹ä½ å¹«å¿™è®“ç¨‹å¼é–‹å§‹é‹ä½œï¼Œä¸¦è®“å–µéšŠé•·å‘å¤§å®¶å ±å‘Šã€Œç³»çµ±å•Ÿå‹•ï¼ã€",
                hint: "æ‰¾æ‰¾çœ‹é»ƒè‰²çš„ç©æœ¨ï¼Œé‚£æ˜¯ç¨‹å¼çš„èµ·é»ï¼é€šå¸¸æ˜¯ã€Œç•¶ç¶ æ——è¢«é»æ“Šã€ã€‚",
                explanation: "ç¨‹å¼éƒ½éœ€è¦ä¸€å€‹å•Ÿå‹•çš„ä¿¡è™Ÿã€‚æˆ‘å€‘ä½¿ç”¨ã€Œç•¶ç¶ æ——è¢«é»æ“Šã€ä½œç‚ºé–‹å§‹ï¼Œæ¥è‘—æ”¾å…¥ã€Œèªªå‡º...ã€ç©æœ¨ï¼Œé€™æ¨£ç¨‹å¼ä¸€åŸ·è¡Œå°±æœƒé¦¬ä¸Šèªªè©±å›‰ï¼",
                concept: ["äº‹ä»¶(Event)", "åŸºæœ¬è…³æœ¬"],
                initialScore: 10,
                availableBlocks: [
                { id: 'flag', text: 'ç•¶ âš‘ è¢«é»æ“Š', type: 'event' },
                { id: 'move10', text: 'ç§»å‹• 10 é»', type: 'motion' },
                { id: 'say_start', text: 'èªªå‡ºã€Œç³»çµ±å•Ÿå‹•!ã€æŒçºŒ2ç§’', type: 'looks' },
                // Distractors
                { id: 'wait_1', text: 'ç­‰å¾… 1 ç§’', type: 'control' },
                { id: 'turn15', text: 'å³è½‰ 15 åº¦', type: 'motion' }
                ],
                solution: ['flag', 'say_start']
            },
            {
                id: 2,
                title: "ç¬¬äºŒé—œï¼šæ­¸é›¶æ ¡æ­£",
                description: "å°èˆªç³»çµ±éŒ¯äº‚ï¼å¤ªç©ºèˆ¹è¿·è·¯äº†ã€‚è«‹å¹«å¿™æŠŠå¤ªç©ºèˆ¹æ‹‰å›åˆ°æ˜Ÿéš›åœ°åœ–çš„æ­£ä¸­å¿ƒä½ç½® (0, 0)ï¼Œé€™æ¨£æ‰èƒ½æº–å‚™é€²è¡Œè·³èºã€‚",
                hint: "èˆå°çš„æ­£ä¸­å¤®åº§æ¨™æ˜¯ X=0, Y=0ã€‚è©¦è‘—ç”¨è—è‰²çš„ç©æœ¨ç›´æ¥å®šä½éå»ã€‚",
                explanation: "åœ¨ Scratch çš„èˆå°åº§æ¨™ä¸­ï¼Œä¸­å¿ƒé»å°±æ˜¯ x:0, y:0ã€‚ä½¿ç”¨ã€Œå®šä½åˆ° x:0 y:0ã€ç©æœ¨ï¼Œå°±èƒ½ä¸ç®¡è§’è‰²åœ¨å“ªè£¡ï¼Œç²¾æº–åœ°æŠŠå®ƒé€å›ç•«é¢æ­£ä¸­å¤®ã€‚",
                concept: ["åº§æ¨™(X,Y)", "å®šä½"],
                initialScore: 10,
                availableBlocks: [
                { id: 'flag', text: 'ç•¶ âš‘ è¢«é»æ“Š', type: 'event' },
                { id: 'goto_random', text: 'å®šä½åˆ° éš¨æ©Ÿä½ç½®', type: 'motion' },
                { id: 'goto_0_0', text: 'å®šä½åˆ° x:0 y:0', type: 'motion' },
                { id: 'change_x', text: 'x æ”¹è®Š 10', type: 'motion' },
                // Distractors
                { id: 'change_y', text: 'y æ”¹è®Š 10', type: 'motion' },
                { id: 'say_pos', text: 'èªªå‡ºã€Œä½ç½®ç¢ºèªã€', type: 'looks' }
                ],
                solution: ['flag', 'goto_0_0']
            },
            {
                id: 3,
                title: "ç¬¬ä¸‰é—œï¼šè‡ªå‹•å°èˆª",
                description: "å•Ÿå‹•è‡ªå‹•é§•é§›æ¨¡å¼ï¼è«‹è¨­å®šå°èˆªç³»çµ±ï¼Œè®“å¤ªç©ºèˆ¹èƒ½å¤ æŒçºŒä¸æ–·åœ°è·Ÿéš¨ä½ çš„æ»‘é¼ æ¸¸æ¨™é£›è¡Œï¼Œé¿é–‹éšœç¤™ç‰©ã€‚",
                hint: "è¦è®“é£›èˆ¹ã€Œä¸€ç›´ã€åšå‹•ä½œï¼Œä½ éœ€è¦ç”¨æ©˜è‰²çš„ã€Œé‡è¤‡ç„¡é™æ¬¡ã€ç©æœ¨æŠŠå‹•ä½œåŒ…èµ·ä¾†ã€‚",
                explanation: "è¦è®“é£›èˆ¹ã€Œä¸€ç›´ã€é‹ä½œï¼Œå¿…é ˆä½¿ç”¨ã€Œé‡è¤‡ç„¡é™æ¬¡ã€è¿´åœˆã€‚åœ¨è¿´åœˆè£¡æ”¾å…¥ã€Œé¢æœé¼ æ¨™ã€å’Œã€Œç§»å‹•ã€ï¼Œé£›èˆ¹å°±æœƒä¸æ–·åœ°è½‰å‘æ»‘é¼ ä¸¦å‰é€²ï¼Œçœ‹èµ·ä¾†å°±åƒåœ¨è·Ÿéš¨ä½ ï¼",
                concept: ["è¿´åœˆ(Loop)", "è·Ÿéš¨æ¸¸æ¨™"],
                initialScore: 10,
                availableBlocks: [
                { id: 'flag', text: 'ç•¶ âš‘ è¢«é»æ“Š', type: 'event' },
                { id: 'forever', text: 'é‡è¤‡ç„¡é™æ¬¡', type: 'control' },
                { id: 'point_mouse', text: 'é¢æœ é¼ æ¨™ å‘', type: 'motion' },
                { id: 'move_steps', text: 'ç§»å‹• 5 é»', type: 'motion' },
                { id: 'wait_1', text: 'ç­‰å¾… 1 ç§’', type: 'control' },
                // Distractors
                { id: 'bounce', text: 'ç¢°åˆ°é‚Šç·£å°±åå½ˆ', type: 'motion' },
                { id: 'turn_15', text: 'å³è½‰ 15 åº¦', type: 'motion' }
                ],
                solution: ['flag', 'forever', 'point_mouse', 'move_steps']
            },
            {
                id: 4,
                title: "ç¬¬å››é—œï¼šå¤–æ˜Ÿè¨Šè™Ÿ",
                description: "åµæ¸¬åˆ°å¤–æ˜Ÿè¨Šè™Ÿï¼å¦‚æœåœ¨æ—…é€”ä¸­ä¸å°å¿ƒç¢°åˆ°å¤–æ˜Ÿäººï¼Œè«‹å…ˆèªªå‡ºã€Œä½ å¥½ã€ï¼Œå†ç™¼é€è¨Šè™Ÿä¸¦åˆ‡æ›åˆ°å¤–æ˜ŸåŸºåœ°å ´æ™¯ã€‚",
                hint: "å…ˆæª¢æŸ¥æ˜¯å¦ã€Œç¢°åˆ°å¤–æ˜Ÿäººã€(åµæ¸¬)ï¼Œå¦‚æœç¢°åˆ°äº†ï¼Œè¨˜å¾—å…ˆã€Œèªªå‡ºä½ å¥½ã€ï¼Œç„¶å¾Œæ‰ç™¼å‡ºã€Œå»£æ’­ã€ä¸¦ã€Œåˆ‡æ›èƒŒæ™¯ã€ã€‚",
                explanation: "é€™æ˜¯æ¨™æº–çš„ã€Œåµæ¸¬ã€é‚è¼¯ã€‚æˆ‘å€‘æŠŠã€Œå¦‚æœ...é‚£éº¼ã€æ”¾åœ¨ç„¡é™è¿´åœˆè£¡ï¼Œé›»è…¦å°±æœƒéš¨æ™‚æª¢æŸ¥æ˜¯å¦ã€Œç¢°åˆ°å¤–æ˜Ÿäººã€ã€‚ä¸€æ—¦ç¢°åˆ°ï¼Œå°±æœƒä¾åºåŸ·è¡Œï¼šèªªä½ å¥½ -> å»£æ’­ -> æ›èƒŒæ™¯ã€‚",
                concept: ["åµæ¸¬(Sensing)", "å»£æ’­", "æ¢ä»¶åˆ¤æ–·"],
                initialScore: 10,
                availableBlocks: [
                { id: 'flag', text: 'ç•¶ âš‘ è¢«é»æ“Š', type: 'event' },
                { id: 'forever', text: 'é‡è¤‡ç„¡é™æ¬¡', type: 'control' },
                { id: 'if_touching', text: 'å¦‚æœ <ç¢°åˆ° å¤–æ˜Ÿäºº ?> é‚£éº¼', type: 'control' },
                { id: 'say_hello', text: 'èªªå‡ºã€Œä½ å¥½ã€æŒçºŒ2ç§’', type: 'looks' },
                { id: 'broadcast', text: 'å»£æ’­è¨Šæ¯ã€Œä½ å¥½ã€', type: 'event' },
                { id: 'switch_bg', text: 'èƒŒæ™¯æ›æˆã€Œå¤–æ˜ŸåŸºåœ°ã€', type: 'looks' },
                // Distractors
                { id: 'wait_1', text: 'ç­‰å¾… 1 ç§’', type: 'control' },
                { id: 'turn_15', text: 'å³è½‰ 15 åº¦', type: 'motion' }
                ],
                solution: ['flag', 'forever', 'if_touching', 'say_hello', 'broadcast', 'switch_bg']
            },
            {
                id: 5,
                title: "ç¬¬äº”é—œï¼šèƒ½é‡æ”¶é›†",
                description: "ç™¼ç¾èƒ½é‡æ°´æ™¶ï¼æˆ‘å€‘éœ€è¦æ”¶é›†å®ƒå€‘ã€‚æ¯ç•¶å¤ªç©ºèˆ¹ç¢°åˆ°æ°´æ™¶æ™‚ï¼Œæœƒç™¼å‡ºã€Œå®ã€çš„éŸ³æ•ˆï¼Œä¸¦ä¸”èƒ½é‡æŒ‡æ•¸æœƒ+1ã€‚",
                hint: "é€™æ˜¯ã€Œè®Šæ•¸ã€çš„æ‡‰ç”¨ã€‚ç•¶åµæ¸¬åˆ°æ°´æ™¶æ™‚ï¼Œä½¿ç”¨æ©˜ç´…è‰²çš„è®Šæ•¸ç©æœ¨è®“æ•¸å€¼å¢åŠ ï¼Œåˆ¥å¿˜äº†é‚„è¦åŠ ä¸ŠéŸ³æ•ˆå–”ï¼",
                explanation: "è®Šæ•¸å°±åƒä¸€å€‹è¨ˆåˆ†æ¿ã€‚ç•¶æˆ‘å€‘åµæ¸¬åˆ°ç¢°åˆ°æ°´æ™¶æ™‚ï¼ŒåŒæ™‚åŸ·è¡Œã€Œæ’­æ”¾éŸ³æ•ˆã€å’Œã€Œè®Šæ•¸æ”¹è®Š 1ã€ï¼Œé€™æ¨£å°±èƒ½æœ‰è²å…‰æ•ˆæœçš„å¾—åˆ†å›é¥‹äº†ï¼",
                concept: ["è®Šæ•¸(Variable)", "è¨ˆåˆ†æ©Ÿåˆ¶"],
                initialScore: 10,
                availableBlocks: [
                { id: 'flag', text: 'ç•¶ âš‘ è¢«é»æ“Š', type: 'event' },
                { id: 'forever', text: 'é‡è¤‡ç„¡é™æ¬¡', type: 'control' },
                { id: 'if_touching_gem', text: 'å¦‚æœ <ç¢°åˆ° æ°´æ™¶ ?> é‚£éº¼', type: 'control' },
                { id: 'change_score', text: 'è®Šæ•¸ [èƒ½é‡] æ”¹è®Š 1', type: 'variable' },
                { id: 'play_sound', text: 'æ’­æ”¾éŸ³æ•ˆã€Œå®ã€', type: 'sound' },
                { id: 'set_score', text: 'è®Šæ•¸ [èƒ½é‡] è¨­ç‚º 0', type: 'variable' },
                // Distractors
                { id: 'hide', text: 'éš±è—', type: 'looks' }
                ],
                solution: ['flag', 'forever', 'if_touching_gem', 'play_sound', 'change_score']
            },
            {
                id: 6,
                title: "ç¬¬å…­é—œï¼šé‚Šç•Œè­¦å ±",
                description: "ä¸èƒ½é£›å‡ºæ˜Ÿç³»é‚Šç·£ï¼å¤ªç©ºèˆ¹ç›®å‰å®šä½åœ¨(200,0)ï¼Œå·²ç¶“ç¢°åˆ°é‚Šç·£äº†!ä¸¦ç™¼å‡ºã€Œå“å‘€!ã€çš„è­¦å‘Šè²!è«‹è¶•å¿«å¹«å¿™è¨­å®šä¿è­·æ©Ÿåˆ¶ï¼Œè®“å¤ªç©ºèˆ¹åœ¨ç¢°åˆ°é‚Šç·£æ™‚ï¼Œæœƒè‡ªå‹•åå½ˆå›ä¾†ï¼Œä¸æœƒæœ‰è­¦å‘Šè²ã€‚",
                hint: "å…ˆã€Œå®šä½ã€åˆ°å³é‚Šé‚Šç·£ï¼Œç„¶å¾Œç™¼å‡ºã€ŒéŸ³æ•ˆã€ã€‚æ¥è‘—åœ¨ç„¡é™è¿´åœˆè£¡è®“å®ƒç§»å‹•ï¼Œä¸¦åŠ ä¸Šã€Œç¢°åˆ°é‚Šç·£å°±åå½ˆã€ã€‚",
                explanation: "é€™æ˜¯ä¸€å€‹é€£çºŒå‹•ä½œï¼šåˆå§‹åŒ–ï¼ˆå®šä½ã€éŸ³æ•ˆï¼‰ -> è¿´åœˆï¼ˆç§»å‹•ã€åå½ˆï¼‰ã€‚æŠŠã€Œç¢°åˆ°é‚Šç·£å°±åå½ˆã€æ”¾åœ¨ç§»å‹•å¾Œé¢ï¼Œå°±èƒ½ç¢ºä¿è§’è‰²æ°¸é åœ¨ç•«é¢è£¡é¢ï¼",
                concept: ["å‹•ä½œ", "é‚Šç•Œåµæ¸¬"],
                initialScore: 10,
                availableBlocks: [
                { id: 'flag', text: 'ç•¶ âš‘ è¢«é»æ“Š', type: 'event' },
                { id: 'goto_edge', text: 'å®šä½åˆ° x:200 y:0', type: 'motion' },
                { id: 'play_ouch', text: 'æ’­æ”¾éŸ³æ•ˆã€Œå“å‘€!ã€ç›´åˆ°çµæŸ', type: 'sound' },
                { id: 'forever', text: 'é‡è¤‡ç„¡é™æ¬¡', type: 'control' },
                { id: 'move_10', text: 'ç§»å‹• 10 é»', type: 'motion' },
                { id: 'bounce', text: 'ç¢°åˆ°é‚Šç·£å°±åå½ˆ', type: 'motion' },
                // Distractors
                { id: 'set_x_0', text: 'x è¨­ç‚º 0', type: 'motion' },
                { id: 'say_ouch', text: 'èªªå‡ºã€Œå“å‘€!ã€', type: 'looks' }
                ],
                solution: ['flag', 'goto_edge', 'play_ouch', 'forever', 'move_10', 'bounce']
            },
            {
                id: 7,
                title: "ç¬¬ä¸ƒé—œï¼šé›™æ ¸å¿ƒé‹ä½œ",
                description: "æˆ‘å€‘éœ€è¦åŒæ™‚å•Ÿå‹•å…©å€‹ç³»çµ±ï¼è«‹è®“å¼•æ“ç³»çµ±ä¸€ç›´ä¿æŒç§»å‹•ç‹€æ…‹ï¼ŒåŒæ™‚é›·é”ç³»çµ±ä¹Ÿè¦ä¸€ç›´æ’­æ”¾éŸ³æ•ˆï¼Œå…©è€…äº’ä¸å¹²æ“¾ã€‚",
                hint: "æƒ³æƒ³çœ‹ï¼Œå¦‚æœè¦è®“å…©ä»¶äº‹ã€ŒåŒæ™‚ã€ç™¼ç”Ÿï¼Œæˆ‘å€‘æ˜¯ä¸æ˜¯éœ€è¦å…©å€‹ã€Œé ­ã€ï¼ˆç¶ æ——ï¼‰ä¾†åˆ†åˆ¥æŒ‡æ®å‘¢ï¼Ÿ",
                explanation: "é€™å°±æ˜¯ã€Œå¹³è¡Œè™•ç†ã€çš„æ¦‚å¿µï¼å°±åƒæˆ‘å€‘èƒ½ä¸€é‚Šèµ°è·¯ä¸€é‚Šå”±æ­Œä¸€æ¨£ã€‚åœ¨ Scratch è£¡ï¼Œæˆ‘å€‘å¯ä»¥å¯«å¥½å¹¾å€‹ã€Œç•¶ç¶ æ——è¢«é»æ“Šã€çš„è…³æœ¬ï¼Œå®ƒå€‘æœƒåŒæ™‚ä¸€èµ·åŸ·è¡Œã€‚",
                concept: ["å¹³è¡Œè™•ç†", "å¤šè…³æœ¬"],
                initialScore: 10,
                availableBlocks: [
                { id: 'flag', text: 'ç•¶ âš‘ è¢«é»æ“Š', type: 'event' },
                { id: 'forever', text: 'é‡è¤‡ç„¡é™æ¬¡', type: 'control' },
                { id: 'move_10', text: 'ç§»å‹• 10 é»', type: 'motion' },
                { id: 'play_radar', text: 'æ’­æ”¾éŸ³æ•ˆã€Œé›·é”ã€ç›´åˆ°çµæŸ', type: 'sound' },
                // Distractors
                { id: 'wait_1', text: 'ç­‰å¾… 1 ç§’', type: 'control' },
                { id: 'turn_15', text: 'å³è½‰ 15 åº¦', type: 'motion' }
                ],
                solution: ['flag', 'forever', 'move_10', 'flag', 'forever', 'play_radar']
            },
            {
                id: 8,
                title: "ç¬¬å…«é—œï¼šå®‰å…¨é™è½",
                description: "æº–å‚™é™è½åœ¨æ˜Ÿçƒè¡¨é¢ã€‚ç‚ºäº†å®‰å…¨ï¼Œæˆ‘å€‘ä¸èƒ½ç›´æ¥æ’ä¸Šå»ï¼Œè«‹æ§åˆ¶å¤ªç©ºèˆ¹èŠ± 2 ç§’é˜çš„æ™‚é–“ï¼Œæ…¢æ…¢é™è½åˆ°æŒ‡å®šåº§æ¨™ (x:0, y:-100)ï¼Œä¸¦ç­‰å¾…ä¸€ç§’å¾Œé€šçŸ¥å¤ªç©ºç«™å·²æˆåŠŸã€‚",
                hint: "ã€Œå®šä½åˆ°ã€æ˜¯ç¬é–“ç§»å‹•ï¼Œã€Œæ»‘è¡Œã€å‰‡æœ‰ç§»å‹•éç¨‹ã€‚ç‚ºäº†ç¢ºä¿é€šè¨Šé †æš¢ï¼Œèªªè©±å‰å¯ä»¥å…ˆã€Œç­‰å¾…ã€ä¸€ä¸‹å–”ï¼",
                explanation: "ã€Œæ»‘è¡Œã€ç©æœ¨å¯ä»¥å‰µé€ å¹³æ»‘çš„ç§»å‹•æ•ˆæœã€‚ç‚ºäº†æ¨¡æ“¬çœŸå¯¦æƒ…æ³ï¼Œæˆ‘å€‘åœ¨é™è½å¾ŒåŠ å…¥ã€Œç­‰å¾…ã€å†å›å ±æˆåŠŸï¼Œè®“æµç¨‹æ›´è‡ªç„¶ã€‚",
                concept: ["æ»‘è¡Œ(Glide)", "åº§æ¨™ç§»å‹•", "ç­‰å¾…"],
                initialScore: 10,
                availableBlocks: [
                { id: 'flag', text: 'ç•¶ âš‘ è¢«é»æ“Š', type: 'event' },
                { id: 'glide', text: 'åœ¨ 2 ç§’å…§æ»‘è¡Œåˆ° x:0 y:-100', type: 'motion' },
                { id: 'wait_1', text: 'ç­‰å¾… 1 ç§’', type: 'control' },
                { id: 'say_success', text: 'èªªå‡ºã€Œé™è½æˆåŠŸã€', type: 'looks' },
                // Distractors
                { id: 'goto', text: 'å®šä½åˆ° x:0 y:-100', type: 'motion' },
                { id: 'change_y', text: 'y æ”¹è®Š -10', type: 'motion' }
                ],
                solution: ['flag', 'glide', 'wait_1', 'say_success']
            },
            {
                id: 9,
                title: "ç¬¬ä¹é—œï¼šè‡ªå‹•åœç…",
                description: "å¤ªç©ºèˆ¹æ­£åœ¨è‡ªå‹•è¿”èˆªã€‚ä½†å¼•æ“å‡ºå•é¡Œäº†ï¼Œåº§æ¨™ä¸€ç›´å®šä½åˆ°éš¨æ©Ÿä½ç½®ï¼Œç„¡æ³•èª¿æ•´ï¼Œè«‹è¶•å¿«åŠ ä¸Šå®‰å…¨æ©Ÿåˆ¶ï¼Œä¸€æ—¦ç¢°åˆ°åŸºåœ°ï¼Œå°±è¦ç«‹åˆ»åœæ­¢æ‰€æœ‰é‹ä½œï¼Œä»¥å…ç™¼ç”Ÿå•é¡Œã€‚",
                hint: "éœ€è¦ä¸€å€‹èƒ½ä¸æ–·åŸ·è¡Œçš„è¿´åœˆï¼Œåœ¨è£¡é¢ç§»å‹•ä¸¦éš¨æ™‚æª¢æŸ¥ã€Œå¦‚æœã€ç¢°åˆ°åŸºåœ°ï¼Œã€Œé‚£éº¼ã€å°±åŸ·è¡Œåœæ­¢æŒ‡ä»¤ã€‚",
                explanation: "ã€Œå¦‚æœ...é‚£éº¼...ã€æ˜¯ç¨‹å¼ä¸­æœ€é‡è¦çš„åˆ¤æ–·å·¥å…·ï¼æŠŠå®ƒæ”¾åœ¨è¿´åœˆè£¡ï¼Œç¨‹å¼å°±æœƒä¸æ–·æª¢æŸ¥æ¢ä»¶ã€‚ä¸€æ—¦æ¢ä»¶æˆç«‹ï¼ˆç¢°åˆ°åŸºåœ°ï¼‰ï¼ŒåŸ·è¡Œã€Œåœæ­¢å…¨éƒ¨ã€ï¼Œé£›èˆ¹å°±æœƒä¹–ä¹–åœä¸‹ä¾†ã€‚",
                concept: ["æ¢ä»¶åˆ¤æ–·(If...Then)", "åœæ­¢ç¨‹å¼"],
                initialScore: 10,
                availableBlocks: [
                { id: 'flag', text: 'ç•¶ âš‘ è¢«é»æ“Š', type: 'event' },
                { id: 'forever', text: 'é‡è¤‡ç„¡é™æ¬¡', type: 'control' },
                { id: 'goto_random', text: 'å®šä½åˆ° éš¨æ©Ÿä½ç½®', type: 'motion' },
                { id: 'if_touching_base', text: 'å¦‚æœ <ç¢°åˆ° åŸºåœ° ?> é‚£éº¼', type: 'control' },
                { id: 'stop_all', text: 'åœæ­¢ [å…¨éƒ¨]', type: 'control' },
                // Distractors
                { id: 'move_10', text: 'ç§»å‹• 10 é»', type: 'motion' },
                { id: 'repeat_until', text: 'é‡è¤‡ç›´åˆ° <...>', type: 'control' }
                ],
                solution: ['flag', 'forever', 'goto_random', 'if_touching_base', 'stop_all']
            },
            {
                id: 10,
                title: "ç¬¬åé—œï¼šç››å¤§éŠè¡Œ",
                description: "ä»»å‹™åœ“æ»¿å®Œæˆï¼æˆ‘å€‘è¦èˆ‰è¾¦ä¸€å ´ç››å¤§çš„éŠè¡Œã€‚å–µéšŠé•·ç‚ºäº†æ…¶ç¥ï¼Œä¸åƒ…åœ¨ç¾å ´æœ‰æ’­æ”¾æ…¶ç¥éŸ³æ¨‚ï¼Œå–µéšŠé•·ä¹Ÿè®Šæ›å¾ˆå¤šç¨®é€ å‹éŠè¡Œï¼Œä¸¦åœ¨æœ€å¾Œä¸€å€‹é€ å‹çµæŸå¾Œï¼Œå¸äº†ä¸€å£æ°£å¤§è²èªªå‡ºYA!",
                hint: "å‹•ä½œå’ŒéŸ³æ¨‚è¦åˆ†é–‹é€²è¡Œï¼é€ å‹è®Šæ›å¯ä»¥è¨­å®šã€Œé‡è¤‡ 10 æ¬¡ã€ï¼Œæ¯æ¬¡è®Šæ›å¾Œéƒ½è¦ã€Œç­‰å¾…ã€ä¸€ä¸‹ï¼ŒçµæŸå¾Œæ‰èƒ½æ¥çºŒèªªè©±ã€‚",
                explanation: "ç‚ºäº†è®“ã€Œèªªå‡ºYA!ã€ç™¼ç”Ÿåœ¨å‹•ä½œçµæŸå¾Œï¼Œæˆ‘å€‘ä½¿ç”¨ã€Œé‡è¤‡10æ¬¡ã€è€Œä¸æ˜¯ç„¡é™æ¬¡ï¼Œä¸¦åŠ å…¥ã€Œç­‰å¾…ã€æ§åˆ¶ç¯€å¥ã€‚åŒæ™‚ï¼Œç‚ºäº†ä¸è®“éŸ³æ¨‚ä¸­æ–·ï¼Œæˆ‘å€‘æŠŠéŸ³æ¨‚æ”¾åœ¨å¦ä¸€å€‹ç¨ç«‹çš„ç„¡é™è¿´åœˆè…³æœ¬ä¸­ã€‚",
                concept: ["ç¶œåˆæ‡‰ç”¨", "å¹³è¡Œè™•ç†", "æœ‰é™è¿´åœˆ"],
                initialScore: 10,
                availableBlocks: [
                { id: 'flag', text: 'ç•¶ âš‘ è¢«é»æ“Š', type: 'event' },
                { id: 'forever', text: 'é‡è¤‡ç„¡é™æ¬¡', type: 'control' },
                { id: 'repeat_10', text: 'é‡è¤‡ 10 æ¬¡', type: 'control' },
                { id: 'next_costume', text: 'é€ å‹æ›æˆ ä¸‹ä¸€å€‹', type: 'looks' },
                { id: 'play_music', text: 'æ’­æ”¾éŸ³æ•ˆã€Œæ…¶å…¸ã€ç›´åˆ°çµæŸ', type: 'sound' },
                { id: 'wait_05', text: 'ç­‰å¾… 0.5 ç§’', type: 'control' },
                { id: 'say_ya', text: 'èªªå‡ºã€ŒYA!ã€æŒçºŒ2ç§’', type: 'looks' },
                // Distractors
                { id: 'turn_15', text: 'å³è½‰ 15 åº¦', type: 'motion' }
                ],
                solution: ['flag', 'forever', 'play_music', 'flag', 'repeat_10', 'next_costume', 'wait_05', 'say_ya']
            }
        ];

        // --- HELPER FUNCTIONS ---
        const isContainerBlock = (blockId) => {
            return ['forever', 'if_touching', 'if_touching_gem', 'if_touching_base', 'repeat_until', 'repeat_10'].includes(blockId);
        };

        const isHatBlock = (blockId) => {
            return ['flag', 'key_space'].includes(blockId);
        };

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // --- COMPONENTS ---
        const Block = ({ block, onClick, isSelected, indentLevel = 0, isContainer = false }) => {
            const getColors = (type) => {
                switch (type) {
                case 'event': return 'bg-yellow-400 border-yellow-600 text-yellow-900';
                case 'motion': return 'bg-blue-500 border-blue-700 text-white';
                case 'control': return 'bg-orange-400 border-orange-600 text-white';
                case 'looks': return 'bg-purple-500 border-purple-700 text-white';
                case 'sound': return 'bg-pink-400 border-pink-600 text-white';
                case 'sensing': return 'bg-cyan-400 border-cyan-600 text-white';
                case 'variable': return 'bg-orange-500 border-orange-700 text-white';
                case 'operator': return 'bg-green-500 border-green-700 text-white';
                default: return 'bg-gray-400';
                }
            };

            const baseClasses = `
                ${getColors(block.type)} 
                px-3 py-2 rounded-md cursor-pointer shadow-sm border-l-4 font-medium text-sm select-none transition-transform active:scale-95
                ${isSelected ? 'opacity-50' : 'hover:brightness-110'}
                flex items-center gap-2 relative z-10
            `;

            const containerClasses = isContainer ? 'rounded-b-none mb-0' : 'mb-2';
            
            // Dynamic Icon Component
            let IconComponent = Icons.Square; // Default
            if (block.type === 'event') IconComponent = Icons.Play;
            if (block.type === 'motion') IconComponent = Icons.Move;
            if (block.type === 'control') IconComponent = Icons.RotateCcw;
            if (block.type === 'looks') IconComponent = Icons.ImageIcon;
            if (block.type === 'sound') IconComponent = Icons.Volume2;
            if (block.type === 'sensing') IconComponent = Icons.MousePointer;
            if (block.type === 'variable') IconComponent = Icons.Calculator;
            if (block.type === 'operator') IconComponent = Icons.Calculator;

            return (
                <div className="relative">
                <div onClick={onClick} className={`${baseClasses} ${containerClasses}`}>
                    <IconComponent size={14} />
                    {block.text}
                    {isContainer && <Icons.CornerDownRight size={16} className="ml-auto opacity-50" />}
                </div>
                </div>
            );
        };

        // --- MAIN APP ---
        function ScratchAdventureApp() {
            const [currentLevelIdx, setCurrentLevelIdx] = useState(0);
            const [scriptArea, setScriptArea] = useState([]);
            const [score, setScore] = useState(0);
            const [totalScore, setTotalScore] = useState(0);
            const [gameState, setGameState] = useState('intro'); // intro, playing, success, fail, complete
            const [feedback, setFeedback] = useState("");
            const [showAnimation, setShowAnimation] = useState(false);
            const [showHint, setShowHint] = useState(false); 
            const [attempts, setAttempts] = useState(0);
            const [isLevelFailed, setIsLevelFailed] = useState(false);
            const [shuffledBlocks, setShuffledBlocks] = useState([]);
            const [costumeFrame, setCostumeFrame] = useState(0);
            const [playerName, setPlayerName] = useState(""); 
            
            // Animation states
            const [autoMousePos, setAutoMousePos] = useState({ x: 50, y: 50 });
            const [rocketRotation, setRocketRotation] = useState(0);

            const currentLevel = LEVELS[currentLevelIdx];

            useEffect(() => {
                if (currentLevel) {
                    setShuffledBlocks(shuffleArray(currentLevel.availableBlocks));
                }
            }, [currentLevelIdx]);

            // Animation loops
            useEffect(() => {
                if (currentLevel.id === 10 && showAnimation) {
                    const interval = setInterval(() => {
                        setCostumeFrame(prev => prev + 1);
                    }, 500); 
                    return () => clearInterval(interval);
                }
                
                if (currentLevel.id === 3 && showAnimation) {
                    let angle = 0;
                    const interval = setInterval(() => {
                        angle += 0.05;
                        const x = 50 + 35 * Math.cos(angle);
                        const y = 50 + 35 * Math.sin(angle);
                        const rotation = (angle * 180 / Math.PI) + 90 + 45; 
                        setAutoMousePos({ x, y });
                        setRocketRotation(rotation);
                    }, 20);
                    return () => clearInterval(interval);
                }
            }, [currentLevel.id, showAnimation]);

            const addToScript = (block) => {
                if (gameState !== 'playing') return;
                setScriptArea([...scriptArea, block]);
            };

            const removeFromScript = (index) => {
                if (gameState !== 'playing') return;
                const newScript = [...scriptArea];
                newScript.splice(index, 1);
                setScriptArea(newScript);
            };

            const clearScript = () => {
                if (gameState === 'success') return;
                setScriptArea([]);
            };

            const checkAnswer = () => {
                const userIds = scriptArea.map(b => b.id);
                const solutionIds = currentLevel.solution;
                const hasDistractors = userIds.some(id => !solutionIds.includes(id));
                
                // Count check
                const solutionCounts = solutionIds.reduce((acc, id) => { acc[id] = (acc[id] || 0) + 1; return acc; }, {});
                const userCounts = userIds.reduce((acc, id) => { acc[id] = (acc[id] || 0) + 1; return acc; }, {});

                let isCorrect = true;
                for (const id of solutionIds) {
                    if ((userCounts[id] || 0) < solutionCounts[id]) {
                        isCorrect = false;
                        break;
                    }
                }
                
                // Check if distractors are present (only allow blocks that are in the solution)
                const uniqueSolutionIds = new Set(solutionIds);
                for (const id of userIds) {
                    if (!uniqueSolutionIds.has(id)) {
                        isCorrect = false;
                        break;
                    }
                }

                if (isCorrect) {
                    setGameState('success');
                    setShowAnimation(true);
                    
                    if (!isLevelFailed) {
                        setFeedback("ç¨‹å¼åŸ·è¡ŒæˆåŠŸï¼é‚è¼¯æ­£ç¢ºï¼(ç²å¾— 10 åˆ†)");
                        setTotalScore(prev => prev + 10);
                    } else {
                        setFeedback("ç¨‹å¼åŸ·è¡ŒæˆåŠŸã€‚ (å› å·²å…¬ä½ˆç­”æ¡ˆï¼Œæœ¬é—œä¸äºˆåŠ åˆ†)");
                    }
                } else {
                    const newAttempts = attempts + 1;
                    setAttempts(newAttempts);

                    if (newAttempts >= 3) {
                        setIsLevelFailed(true);
                        setFeedback("å·²å˜—è©¦éŒ¯èª¤ 3 æ¬¡ã€‚ç‚ºæ‚¨å…¬ä½ˆæ­£ç¢ºç­”æ¡ˆï¼ˆæœ¬é—œç„¡æ³•ç²å¾— 10 åˆ†ï¼‰ã€‚");
                        // Auto-fill solution logic needs to find block objects
                        const solutionBlocks = currentLevel.solution.map(id => 
                            currentLevel.availableBlocks.find(b => b.id === id)
                        ).filter(Boolean);
                        setScriptArea(solutionBlocks);
                        setGameState('success');
                        setShowAnimation(true);
                    } else {
                        setFeedback(`ç¨‹å¼æœ‰èª¤ï¼è«‹å†æª¢æŸ¥ã€‚(å‰©é¤˜å˜—è©¦æ©Ÿæœƒï¼š${3 - newAttempts})`);
                        // No deduction here
                    }
                }
            };

            const nextLevel = () => {
                if (currentLevelIdx < LEVELS.length - 1) {
                    setCurrentLevelIdx(prev => prev + 1);
                    setScriptArea([]);
                    setGameState('playing');
                    setFeedback("");
                    setShowAnimation(false);
                    setShowHint(false);
                    setAttempts(0);
                    setIsLevelFailed(false);
                } else {
                    setGameState('complete');
                }
            };

            const startGame = () => {
                setGameState('playing');
                setCurrentLevelIdx(0);
                setTotalScore(0);
                setScriptArea([]);
                setFeedback("");
                setShowHint(false);
                setAttempts(0);
                setIsLevelFailed(false);
            };

            const getRenderedScript = () => {
                let currentIndent = 0;
                return scriptArea.map((block) => {
                    if (isHatBlock(block.id)) {
                        currentIndent = 0;
                    }
                    const isContainer = isContainerBlock(block.id);
                    const renderData = {
                        ...block,
                        indentLevel: currentIndent,
                        isContainer
                    };
                    if (isContainer) {
                        currentIndent += 1;
                    }
                    return renderData;
                });
            };

            const renderedScript = getRenderedScript();

            // --- Render Stage ---
            const renderGameStage = () => {
                return (
                <div className={`w-full h-full bg-gray-900 relative overflow-hidden flex items-center justify-center border-4 border-gray-700 transition-all duration-1000 ${showAnimation ? 'border-green-400' : ''}`}>
                    {/* Backgrounds */}
                    {currentLevel.id === 4 && showAnimation && (
                    <div className="absolute inset-0 bg-indigo-900 transition-colors duration-1000 z-0">
                        <div className="absolute bottom-0 w-full h-1/2 flex justify-around items-end pb-2 opacity-60">
                            <div className="text-4xl animate-bounce" style={{animationDelay: '0.1s'}}>ğŸ‘¾</div>
                            <div className="text-3xl animate-bounce" style={{animationDelay: '0.3s'}}>ğŸ‘½</div>
                            <div className="text-5xl animate-bounce" style={{animationDelay: '0.5s'}}>ğŸ‘¾</div>
                            <div className="text-2xl animate-bounce" style={{animationDelay: '0.2s'}}>ğŸ‘½</div>
                            <div className="text-4xl animate-bounce" style={{animationDelay: '0.4s'}}>ğŸ‘¾</div>
                        </div>
                        <div className="absolute top-4 right-10 text-6xl opacity-30 animate-pulse">ğŸ›¸</div>
                        <div className="absolute top-10 left-10 text-4xl opacity-20">ğŸª</div>
                    </div>
                    )}
                    
                    <div className="absolute inset-0 opacity-30 pointer-events-none">
                     {[...Array(20)].map((_, i) => (
                        <div key={i} className="absolute bg-white rounded-full" 
                            style={{
                                width: Math.random() * 3 + 'px', 
                                height: Math.random() * 3 + 'px',
                                top: Math.random() * 100 + '%',
                                left: Math.random() * 100 + '%'
                            }} 
                        />
                     ))}
                    </div>

                    {/* Level 8 Planet */}
                    {currentLevel.id === 8 && (
                    <div className="absolute -bottom-10 left-1/2 -translate-x-1/2 w-[150%] h-48 bg-gradient-to-b from-orange-600 to-orange-800 rounded-t-[100%] border-t-8 border-orange-400 z-0 shadow-2xl overflow-hidden">
                        <div className="absolute top-8 left-[20%] w-16 h-6 bg-orange-900/20 rounded-full rotate-[-10deg]"></div>
                        <div className="absolute top-12 right-[25%] w-24 h-8 bg-orange-900/20 rounded-full rotate-[5deg]"></div>
                        <div className="absolute top-4 left-[60%] w-10 h-4 bg-orange-900/30 rounded-full"></div>
                        <div className="absolute top-10 right-[10%] w-12 h-5 bg-orange-900/20 rounded-full"></div>
                    </div>
                    )}

                    {/* Level 6 Warning Signs */}
                    {currentLevel.id === 6 && !showAnimation && (
                    <div className="absolute inset-0 z-0 overflow-hidden pointer-events-none">
                        {[...Array(10)].map((_, i) => (
                            <div key={i} className="absolute text-yellow-500 text-5xl animate-pulse opacity-80"
                                style={{
                                    top: `${Math.random() * 80 + 10}%`,
                                    left: `${Math.random() * 80 + 10}%`,
                                    transform: `rotate(${Math.random() * 45 - 22.5}deg)`
                                }}>
                            âš ï¸
                            </div>
                        ))}
                    </div>
                    )}

                    {/* Main Character / Rocket */}
                    <div className={`relative z-10 flex flex-col items-center transition-all duration-700 ${showAnimation ? 'scale-110' : 'scale-100'}`}>
                    
                    {currentLevel.id === 1 && (
                        <>
                        <div className={`text-6xl mb-2 ${showAnimation ? 'animate-bounce' : ''}`}>ğŸ˜º</div>
                        {showAnimation && <div className="bg-white text-black px-3 py-1 rounded-full text-xs font-bold animate-pulse">ç³»çµ±å•Ÿå‹•ï¼</div>}
                        </>
                    )}

                    {currentLevel.id === 2 && (
                        <div className={`text-6xl transition-all duration-1000 ${showAnimation ? 'translate-x-0 translate-y-0' : 'translate-x-20 translate-y-12'}`}>
                        ğŸš€
                        <div className="absolute -top-8 left-0 text-xs text-green-400 font-mono">
                            {showAnimation ? 'x:0 y:0' : 'x:120 y:80'}
                        </div>
                        </div>
                    )}

                    {currentLevel.id === 3 && (
                        <div className="relative w-full h-full flex items-center justify-center">
                            <div 
                                className={`text-5xl absolute transition-all duration-75 ease-linear z-10`}
                                style={showAnimation ? { 
                                    left: `${autoMousePos.x}%`, 
                                    top: `${autoMousePos.y}%`,
                                    transform: `translate(-50%, -50%) rotate(${rocketRotation}deg)`
                                } : {}}
                            >
                                {showAnimation ? 'ğŸš€' : 'ğŸš€'}
                            </div>
                            {showAnimation && (
                                <div className="absolute z-20 transition-all duration-75 ease-linear pointer-events-none"
                                    style={{ left: `${autoMousePos.x}%`, top: `${autoMousePos.y}%` }}
                                >
                                    <Icons.MousePointer fill="white" className="text-white drop-shadow-lg transform -rotate-12 translate-x-2 translate-y-2" size={24} />
                                </div>
                            )}
                            {!showAnimation && <div className="text-5xl animate-pulse">ğŸš€</div>}
                        </div>
                    )}

                    {currentLevel.id === 4 && (
                        <div className="flex gap-10 items-center relative">
                            <div className={`text-6xl ${showAnimation ? 'translate-x-10' : ''}`}>ğŸš€</div>
                            {showAnimation && (
                                <div className="absolute -top-12 left-0 bg-white text-black px-2 py-1 rounded-lg text-xs font-bold whitespace-nowrap animate-bounce">ä½ å¥½ï¼</div>
                            )}
                            {!showAnimation && <div className="text-6xl text-green-400">ğŸ‘½</div>}
                        </div>
                    )}

                    {currentLevel.id === 5 && (
                        <div className="relative">
                            <div className={`text-6xl ${showAnimation ? 'animate-pulse' : ''}`}>ğŸš€</div>
                            <div className="absolute -top-10 -right-10 text-4xl animate-ping opacity-50">ğŸ’</div>
                            {showAnimation && (
                                <div className="absolute -top-14 -right-16 flex flex-col gap-1 items-center">
                                    <div className="text-yellow-300 font-bold text-lg animate-bounce">â™ª å®ï¼</div>
                                    <div className="bg-orange-500 text-white px-2 py-0.5 rounded-full font-bold shadow-lg text-xs">èƒ½é‡ +1</div>
                                </div>
                            )}
                        </div>
                    )}

                    {currentLevel.id === 6 && (
                        <div className="w-full h-full relative">
                            {showAnimation && (
                                <div className="absolute inset-0 bg-green-500/20 flex items-center justify-center z-0">
                                    <div className="text-green-300 font-bold text-6xl border-8 border-green-300 p-4 rounded-xl opacity-50 transform -rotate-12">SAFE</div>
                                </div>
                            )}
                            <div className={`text-6xl absolute top-1/2 left-1/2 transition-all duration-1000 ${showAnimation ? '-translate-x-32 rotate-180' : 'translate-x-32'}`} style={{zIndex: 10}}>ğŸš€</div>
                            {showAnimation && <div className="absolute right-0 top-0 bottom-0 w-2 bg-red-500 animate-pulse"></div>}
                            {!showAnimation && (
                                <>
                                <div className="absolute top-1/2 right-4 -translate-y-1/2 text-yellow-300 font-bold animate-ping text-xl">å“å‘€!</div>
                                <div className="absolute top-1/2 left-1/2 transform translate-x-24 -translate-y-14 text-xs text-green-300 bg-black/80 px-2 py-1 rounded font-mono border border-green-500/50">x:200 y:0</div>
                                </>
                            )}
                        </div>
                    )}

                    {currentLevel.id === 7 && (
                        <div className="flex flex-col items-center gap-4">
                            <div className="text-6xl relative">
                                ğŸš€
                                {showAnimation && (
                                <>
                                    <div className="absolute top-1/2 left-full w-32 h-2 bg-blue-400 opacity-50 animate-pulse"></div>
                                    <div className="absolute -top-10 left-0 text-yellow-400 animate-ping">ğŸ“¡</div>
                                </>
                                )}
                            </div>
                            {showAnimation && <div className="text-xs text-green-400">é›™ç³»çµ±é‹ä½œä¸­...</div>}
                        </div>
                    )}

                    {currentLevel.id === 8 && (
                        <div className="relative w-full h-full flex flex-col items-center justify-end pb-8">
                            <div className={`text-6xl absolute left-1/2 -translate-x-1/2 transition-all duration-[2000ms] ease-out ${showAnimation ? 'bottom-44' : 'bottom-[80%]'}`} style={{zIndex: 10}}>
                                ğŸš€
                                {showAnimation && (
                                    <div className="absolute -top-12 left-0 bg-white text-black px-2 py-1 rounded-lg text-xs font-bold whitespace-nowrap animate-bounce delay-1000">é™è½æˆåŠŸï¼</div>
                                )}
                            </div>
                        </div>
                    )}

                    {currentLevel.id === 9 && (
                        <div className="w-full h-full relative flex">
                            <div className={`text-5xl absolute transition-all duration-2000 ease-linear ${showAnimation ? 'bottom-4 right-4' : 'top-4 left-4'}`} style={{zIndex: 10}}>
                                ğŸš€
                            </div>
                            <div className="text-5xl absolute bottom-4 right-4" style={{zIndex: 1}}>
                                ğŸ°
                            </div>
                            {showAnimation && <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-xs text-red-400 font-bold bg-black/50 px-2 rounded">STOP ALL</div>}
                        </div>
                    )}

                    {currentLevel.id === 10 && (
                        <div className={`text-7xl ${showAnimation ? 'animate-bounce' : ''}`}>
                            {showAnimation ? (costumeFrame % 2 === 0 ? 'ğŸ˜º' : 'ğŸ˜¸') : 'ğŸ˜º'}
                            {showAnimation && <div className="text-yellow-400 text-2xl absolute -top-5 right-0">â™«</div>}
                            {showAnimation && <div className="absolute top-0 right-0 bg-white text-black text-xs font-bold px-1 rounded animate-bounce">YA!</div>}
                        </div>
                    )}

                    </div>
                </div>
                );
            };

            // --- MAIN RENDER ---
            if (gameState === 'intro') {
                return (
                <div className="min-h-screen bg-slate-800 text-white flex flex-col items-center justify-center p-4 font-sans">
                    <div className="max-w-2xl text-center space-y-8 flex flex-col items-center">
                    <h1 className="text-5xl font-bold text-yellow-400 mb-4 tracking-wider">æ˜Ÿéš›ç¨‹å¼å¤§å†’éšª</h1>
                    <div className="text-8xl mb-6">ğŸš€</div>
                    <p className="text-xl text-slate-300 leading-relaxed">
                        æ­¡è¿ä¾†åˆ°<b>æ˜Ÿéš›ç¨‹å¼æŒ‡æ®ä¸­å¿ƒ</b>ï¼<br/>
                        å–µéšŠé•·çš„å¤ªç©ºèˆ¹å£æ‰äº†ï¼Œè«‹ç™¼æ®ä½ çš„<b>è°æ˜æ‰æ™º</b>ä¾†ä¿®å¥½å®ƒã€‚<br/>
                        é€™è£¡å…±æœ‰ 10 å€‹ç·Šæ€¥ä¿®å¾©é—œå¡ï¼Œè«‹å…¨åŠ›å”åŠ©å–µéšŠé•·é—–é—œï¼Œ<br/>
                        <b>ä¸ç„¶ä»–å°±å›ä¸ä¾†å°ç£äº†ï¼</b>
                    </p>
                    
                    <div className="flex flex-col gap-4 items-center w-full max-w-md">
                        <input
                            type="text"
                            placeholder="è«‹è¼¸å…¥ä½ çš„åå­—"
                            value={playerName}
                            onChange={(e) => setPlayerName(e.target.value)}
                            className="w-full px-6 py-3 rounded-full text-slate-800 text-center text-lg focus:outline-none focus:ring-4 focus:ring-yellow-400"
                        />
                        <button 
                            onClick={startGame}
                            disabled={!playerName.trim()}
                            className={`
                                bg-green-500 text-white text-2xl font-bold py-4 px-12 rounded-full shadow-lg flex items-center gap-3
                                ${!playerName.trim() ? 'opacity-50 cursor-not-allowed' : 'hover:bg-green-600 transform transition hover:scale-105 active:scale-95'}
                            `}
                        >
                            <Icons.Play fill="currentColor" /> é–‹å§‹é—–é—œ
                        </button>
                    </div>
                    </div>
                </div>
                );
            }

            if (gameState === 'complete') {
                const isSuccess = totalScore >= 60;
                return (
                <div className="min-h-screen bg-slate-900 text-white flex flex-col items-center justify-center p-4">
                    <div className="text-center space-y-6 animate-fade-in-up max-w-2xl w-full">
                    <div className="relative h-64 w-full bg-gray-800 rounded-2xl overflow-hidden border-4 border-gray-700 mb-6">
                        {isSuccess ? (
                        <svg viewBox="0 0 400 300" className="w-full h-full">
                            <rect width="400" height="300" fill="#87CEEB" />
                            <circle cx="350" cy="50" r="30" fill="#FFD700" className="animate-pulse" />
                            <path d="M0 250 Q 200 200 400 250 V 300 H 0 Z" fill="#4CAF50" />
                            <text x="180" y="240" fontSize="60">ğŸš€</text>
                            <text x="220" y="250" fontSize="50" className="animate-bounce">ğŸ˜º</text>
                            <text x="100" y="230" fontSize="40" fontWeight="bold" fill="white" stroke="black" strokeWidth="1">å°ç£</text>
                            <circle cx="50" cy="50" r="5" fill="red" className="animate-ping" style={{animationDuration:'1s'}}/>
                            <circle cx="300" cy="100" r="5" fill="blue" className="animate-ping" style={{animationDuration:'1.5s'}}/>
                        </svg>
                        ) : (
                        <svg viewBox="0 0 400 300" className="w-full h-full">
                            <rect width="400" height="300" fill="#0F172A" />
                            <circle cx="50" cy="50" r="2" fill="white" className="animate-pulse" />
                            <circle cx="350" cy="150" r="2" fill="white" className="animate-pulse" style={{animationDelay:'0.5s'}}/>
                            <circle cx="200" cy="250" r="2" fill="white" className="animate-pulse" style={{animationDelay:'1s'}}/>
                            <g transform="translate(200, 150) rotate(45)">
                                <text x="-30" y="10" fontSize="60" className="opacity-80">ğŸš€</text>
                            </g>
                            <circle cx="200" cy="150" r="40" fill="rgba(255,255,255,0.1)" stroke="white" strokeWidth="2"/>
                            <text x="182" y="165" fontSize="35">ğŸ˜¿</text>
                            <text x="200" y="250" fontSize="16" fill="white" textAnchor="middle" fontFamily="monospace">CONNECTION LOST...</text>
                        </svg>
                        )}
                    </div>

                    <h2 className="text-4xl font-bold">
                        {isSuccess ? "ä»»å‹™åœ“æ»¿å®Œæˆï¼" : "ä»»å‹™å¤±æ•—..."}
                    </h2>
                    
                    <div className="bg-white/10 p-8 rounded-2xl backdrop-blur-sm border border-white/20">
                        <div className="text-xl mb-2">
                        é—–é—œè€…ï¼š<span className="font-bold text-yellow-400">{playerName || "æœªå…·å"}</span>
                        </div>
                        <div className="text-gray-300 mb-4 text-sm">æœ€çµ‚æˆç¸¾</div>
                        <div className={`text-6xl font-bold ${isSuccess ? 'text-green-400' : 'text-red-400'}`}>
                        {totalScore} / 100 åˆ†
                        </div>
                        <p className="mt-4 text-lg">
                        {isSuccess 
                            ? "å¤ªæ£’äº†ï¼å–µéšŠé•·æˆåŠŸä¿®å¾©å¤ªç©ºèˆ¹ï¼Œå¹³å®‰è¿”å›å°ç£ï¼ğŸ‰" 
                            : "ç³Ÿç³•ï¼åˆ†æ•¸ä¸è¶³ï¼Œå–µéšŠé•·åªèƒ½æ°¸é ç•™åœ¨å¤–å¤ªç©ºä¸­äº†... ğŸ˜­"}
                        </p>
                    </div>

                    <button 
                        onClick={startGame}
                        className="mt-8 text-blue-400 hover:text-blue-300 underline"
                    >
                        å†ç©ä¸€æ¬¡
                    </button>
                    </div>
                </div>
                );
            }

            return (
                <div className="min-h-screen bg-slate-100 flex flex-col font-sans text-slate-800 overflow-hidden">
                {/* Header */}
                <header className="bg-indigo-600 text-white p-3 shadow-md flex justify-between items-center sticky top-0 z-50 shrink-0">
                    <div className="flex items-center gap-3">
                    <div className="bg-white/20 p-2 rounded-lg"><Icons.Star fill="currentColor" className="text-yellow-300"/></div>
                    <div>
                        <h1 className="text-lg font-bold">æ˜Ÿéš›ç¨‹å¼å¤§å†’éšª</h1>
                        <div className="text-xs opacity-80">Level {currentLevel.id}: {currentLevel.title}</div>
                    </div>
                    </div>
                    <div className="flex items-center gap-6">
                    <div className="flex flex-col items-end">
                        {playerName && <span className="text-sm font-medium text-indigo-100 flex items-center gap-1"><Icons.User size={14}/> {playerName}</span>}
                        <div className="flex items-baseline gap-1">
                        <span className="text-xs opacity-75">åˆ†æ•¸</span>
                        <span className="font-bold text-xl font-mono">{totalScore}</span>
                        </div>
                    </div>
                    </div>
                </header>

                {/* 3-Column Layout: Left (25%), Center (42%), Right (33%) */}
                <main className="flex-1 overflow-hidden p-2 grid grid-cols-12 gap-2 h-full">
                    
                    {/* Left Column: Task & Blocks (25%) */}
                    <div className="col-span-3 flex flex-col gap-2 h-full overflow-hidden">
                        
                        {/* Task (Top) */}
                        <div className="bg-white p-3 rounded-xl shadow-sm border-l-8 border-indigo-500 shrink-0 max-h-[35%] overflow-y-auto">
                            <div className="flex justify-between items-start mb-2">
                                <h2 className="text-sm font-bold text-indigo-700 flex items-center gap-1">
                                    <Icons.AlertCircle size={16}/> ä»»å‹™ç›®æ¨™
                                </h2>
                                <button onClick={() => setShowHint(!showHint)} className="flex items-center gap-1 text-[10px] bg-yellow-100 text-yellow-700 px-2 py-1 rounded hover:bg-yellow-200 transition">
                                    <Icons.Lightbulb size={12} fill={showHint ? "currentColor" : "none"} />
                                    {showHint ? "éš±è—" : "æç¤º"}
                                </button>
                            </div>
                            <p className="text-slate-600 mb-2 text-xs leading-relaxed">{currentLevel.description}</p>
                            {showHint && (
                                <div className="mt-1 bg-yellow-50 p-2 rounded text-xs text-yellow-800 border border-yellow-200 animate-fade-in flex gap-1">
                                    <span className="shrink-0">ğŸ’¡</span><span>{currentLevel.hint}</span>
                                </div>
                            )}
                        </div>

                        {/* Blocks (Bottom) */}
                        <div className="bg-slate-200 rounded-xl p-2 overflow-y-auto border border-slate-300 flex-1 min-h-0 flex flex-col">
                            <h3 className="font-bold text-slate-600 mb-1 flex items-center gap-2 shrink-0 text-sm">
                                <Icons.Layers size={14}/> ç©æœ¨å€
                            </h3>
                            <div className="space-y-1 flex-1 overflow-y-auto pr-1">
                                {shuffledBlocks.map((block) => (
                                    <Block key={block.id} block={block} onClick={() => addToScript(block)} isContainer={isContainerBlock(block.id)} />
                                ))}
                            </div>
                            <div className="bg-yellow-100 text-yellow-800 text-[10px] p-1 rounded mt-1 border border-yellow-200 flex items-start gap-1 shrink-0">
                                <Icons.AlertCircle size={10} className="shrink-0 mt-0.5" />
                                <span>éƒ¨åˆ†ç©æœ¨æ˜¯å¹²æ“¾é …å–”ï¼</span>
                            </div>
                        </div>
                    </div>

                    {/* Center Column: Editor (42%) */}
                    <div className="col-span-5 flex flex-col h-full overflow-hidden bg-white rounded-xl shadow-inner border-2 border-slate-200 relative">
                        <div className="flex justify-between items-center p-2 border-b border-slate-100 shrink-0">
                            <h3 className="font-bold text-slate-700 flex items-center gap-2 text-sm">
                                <Icons.ImageIcon size={16}/> ç·¨è¼¯å€
                            </h3>
                            <button onClick={clearScript} className="text-xs text-red-500 hover:text-red-700 font-medium px-2 py-1 rounded hover:bg-red-50 disabled:opacity-30 disabled:hover:text-red-500" disabled={gameState === 'success'}>
                                <Icons.RotateCw size={12} className="inline mr-1"/>é‡æ–°é–‹å§‹
                            </button>
                        </div>
                        <div className="flex-1 p-2 overflow-y-auto bg-slate-50/50">
                            {scriptArea.length === 0 ? (
                                <div className="h-full flex flex-col items-center justify-center text-slate-300">
                                    <Icons.Move size={32} className="mb-2 opacity-20" />
                                    <p className="text-xs">é»æ“Šå·¦å´ç©æœ¨åŠ å…¥</p>
                                </div>
                            ) : (
                                <div className="space-y-0">
                                    {renderedScript.map((block, index) => (
                                        <div key={`${block.id}-${index}`} className="relative group">
                                            {isHatBlock(block.id) && index > 0 && (
                                                <div className="h-6 border-b-2 border-dashed border-slate-300 w-full mb-2 mt-4 relative">
                                                    <span className="absolute -bottom-2.5 left-1/2 -translate-x-1/2 bg-slate-50 px-2 text-[10px] text-slate-400">æ–°è…³æœ¬</span>
                                                </div>
                                            )}
                                            {block.indentLevel > 0 && (
                                                <div className="absolute top-0 bottom-0 border-l-4 border-slate-300 opacity-30 z-0" style={{ left: `${(block.indentLevel * 16) - 10}px` }}></div>
                                            )}
                                            <div style={{ marginLeft: `${block.indentLevel * 16}px` }}>
                                                <Block block={block} onClick={() => {}} isSelected={false} isContainer={block.isContainer} />
                                            </div>
                                            {gameState === 'playing' && (
                                                <button onClick={() => removeFromScript(index)} className="absolute right-0 top-1 text-red-400 opacity-0 group-hover:opacity-100 hover:text-red-600 font-bold bg-white rounded-full w-4 h-4 flex items-center justify-center shadow-sm z-20 border border-red-100 text-[10px]">Ã—</button>
                                            )}
                                            {index < scriptArea.length - 1 && !block.isContainer && !isHatBlock(scriptArea[index+1].id) && (
                                                <div className="h-2 w-4 bg-gray-300 ml-4 -mt-2 mb-0 rounded-b-sm" style={{ marginLeft: `${(block.indentLevel * 16) + 16}px` }}></div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Right Column: Stage & Info (33%) */}
                    <div className="col-span-4 flex flex-col gap-2 h-full overflow-hidden">
                        
                        {/* Game Simulator (Top - 55%) */}
                        <div className="bg-slate-800 rounded-xl shadow-lg border-4 border-slate-700 shrink-0 h-[55%] flex flex-col relative overflow-hidden">
                            <div className="absolute top-2 left-2 z-20 bg-black/50 px-2 py-1 rounded text-[10px] text-white flex items-center gap-1">
                                <Icons.Flag size={10} className="text-green-400"/> èˆå°é è¦½
                            </div>
                            <div className="flex-1 relative min-h-0">
                                {renderGameStage()}
                            </div>
                            <div className="bg-slate-700 p-2 flex justify-center shrink-0">
                                <button 
                                    onClick={checkAnswer}
                                    disabled={scriptArea.length === 0 || gameState === 'success'}
                                    className={`
                                        w-full py-2 rounded-lg font-bold flex items-center justify-center gap-2 transition-all
                                        ${gameState === 'success' ? 'bg-green-500 text-white cursor-default' : 'bg-green-500 hover:bg-green-400 text-white shadow-md border-b-4 border-green-700 active:border-b-0 active:translate-y-1'}
                                        disabled:opacity-50 disabled:cursor-not-allowed disabled:border-b-0 disabled:translate-y-0
                                    `}
                                >
                                    <Icons.Play size={18} fill="currentColor" /> 
                                    {gameState === 'success' ? 'åŸ·è¡ŒæˆåŠŸ' : 'åŸ·è¡Œ (ç¶ æ——)'}
                                </button>
                            </div>
                        </div>

                        {/* Info/Feedback Panel (Bottom - 45%) */}
                        <div className="bg-white rounded-xl shadow-sm border border-slate-200 flex-1 flex flex-col overflow-hidden relative">
                             {/* Feedback Overlay - Always here to show result or placeholder */}
                             <div className={`absolute inset-0 flex flex-col p-3 ${gameState === 'success' ? 'bg-green-50' : (feedback ? 'bg-red-50' : 'bg-white')}`}>
                                 {feedback ? (
                                    <>
                                        <div className={`text-base font-bold mb-2 text-center shrink-0 ${gameState === 'success' ? 'text-green-600' : 'text-red-500'}`}>
                                            {feedback}
                                        </div>
                                        <div className="flex-1 overflow-y-auto custom-scrollbar pr-1">
                                            {gameState === 'success' && (
                                                <div className="bg-white p-3 rounded-lg border border-green-200 text-left text-sm text-slate-600 shadow-sm mb-2">
                                                    <div className="flex items-center gap-2 font-bold text-green-700 mb-1 border-b border-green-100 pb-1">
                                                        <Icons.BookOpen size={14}/> å–µéšŠé•·è¬›è§£
                                                    </div>
                                                    <div className="leading-relaxed text-xs">
                                                        {currentLevel.explanation}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                        <div className="mt-2 flex justify-center shrink-0 pt-2 border-t border-black/5">
                                            {gameState === 'success' ? (
                                                <button onClick={nextLevel} className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-full font-bold shadow-lg flex items-center gap-2 transition-transform hover:scale-105 text-sm">
                                                    {currentLevelIdx === LEVELS.length - 1 ? "æŸ¥çœ‹åˆ†æ•¸" : "ä¸‹ä¸€é—œ"} 
                                                    {currentLevelIdx === LEVELS.length - 1 ? <Icons.Trophy size={16} /> : <Icons.ArrowRight size={16} />}
                                                </button>
                                            ) : (
                                                <button onClick={() => setFeedback("")} className="text-slate-400 text-xs hover:text-slate-600 underline">
                                                    å†è©¦ä¸€æ¬¡
                                                </button>
                                            )}
                                        </div>
                                    </>
                                 ) : (
                                    <div className="flex-1 flex flex-col items-center justify-center text-slate-300 p-4 text-center">
                                        <Icons.MessageCircle size={24} className="mb-2 opacity-50"/>
                                        <p className="text-xs">åŸ·è¡Œç¨‹å¼å¾Œ<br/>å–µéšŠé•·æœƒåœ¨é€™è£¡å‘Šè¨´ä½ çµæœå–”ï¼</p>
                                    </div>
                                 )}
                             </div>
                        </div>

                    </div>

                </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ScratchAdventureApp />);
    </script>
</body>
</html>
